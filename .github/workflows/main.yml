name: ci build 
  
on: [push] 
  
jobs: 
   build: 
     runs-on: ubuntu-latest 
     container: python:3
  
     services: 
       postgres: 
         image: postgres:latest 
         env: 
           POSTGRES_USER: postgres 
           POSTGRES_PASSWORD: posTgress23
  
         ports: 
           - 5432:5432 
  
     steps: 
     - uses: actions/checkout@v2 
     - name: deps 
       run: | 
         pip freeze > requirements.txt
         pip install -r requirements.txt
  
     - name: install psql 
       run: | 
         apt update -y 
         apt install -y postgresql postgresql-contrib 
  
     - name: migrate_database 
       run: | 
         cd scripts_DataBase
         psql -h postgres "sslmode=disable user=postgres port=5432 password=posTgress23" < createDatabase.sql 
         psql -h postgres "sslmode=disable dbname=rsoi_persons user=postgres port=5432 password=posTgress23" < createTable.sql 
         psql -h postgres "sslmode=disable dbname=rsoi_persons user=postgres port=5432 password=posTgress23" < fillTable.sql 
  
     - name: Unit tests 
       run: | 
         cd classes/uniTests 
         python -m unittest discover
